# 需求文檔：智能化量化交易系統 (V1.0)

## 1. 專案總體願景 (Project Vision)

本專案旨在打造一個超越傳統指標規則的**智能化、擬人化思考的量化交易系統**。系統的核心是一個能夠自主學習與決策的**人工智能代理 (AI Agent)**，它將模仿頂尖交易員的思維模式，綜合分析多維度市場資訊，動態地做出交易決策，以實現長期穩定的Alpha收益為最終目標。

## 2. 核心設計理念

### 2.1. 擬人化思考 (Human-like Thinking)

- **告別機械規則**: 系統不應是「指標A觸發就買入，指標B觸發就賣出」的簡單自動化。
- **情境綜合判斷**: AI Agent 必須學會**權衡**。例如，即使一個趨勢指標發出強烈買入信號，但若市場情緒極度恐慌，或相關板塊出現系統性風險，Agent應能自主判斷並**選擇放棄或延遲交易**。
- **風險內化**: 止損止盈不應僅僅依賴於ATR等固定規則。Agent需要將**風險管理內化為決策的一部分**，學會在追求高回報的同時，主動規避可能導致巨大回撤的交易機會。

### 2.2. 多模型測試平台 (Multi-Model Testing Platform)

系統必須是**高度模組化**的，支持建立、訓練和回測多個**不同性格**的AI Agent。這使得我們可以平行比較不同決策模型（例如：保守型Agent vs. 激進型Agent）的長期表現。

### 2.3. 雙策略並行研發 (Dual-Strategy Development)

系統需要同時支持兩種核心交易策略的研發與回測：

1.  **MPT投資組合策略**:
    - **目標**: 針對**多個股票**進行中短期（月/季度）的動態資產配置。
    - **核心**: 訓練一個能理解資產間關聯性、並進行全局優化的**投資組合管理Agent**。

2.  **個股當沖策略**:
    - **目標**: 專注於**單一股票**的日內高頻交易（基於30分鐘或更短週期K線）。
    - **核心**: 訓練一個對特定股票微觀價格波動有深度理解，並能優化交易執行的**專家Agent**。

## 3. 技術棧與環境 (Tech Stack & Environment)

- **主要券商與數據源**: **Capital.com**。
- **開發語言**: Python 3.8+。
- **核心框架**:
    - **機器學習/深度學習**: TensorFlow 或 PyTorch。
    - **強化學習**: Stable Baselines3, RLlib, 或 TensorFlow Agents。
    - **數據分析**: Pandas, NumPy, Scikit-learn。
    - **視覺化**: Plotly (核心), Matplotlib, Seaborn, NetworkX。
    - **互動式儀表板 (Dashboard)**: Dash 或 Streamlit。

## 4. 系統架構藍圖：RL大腦 + ML/DL感官

本系統的架構將模仿生物神經系統：以**強化學習 (RL) 為決策大腦**，以**多個ML/DL模型為周邊感官系統**。

```plaintext
+---------------------------------+
|     多元數據源 (Capital.com)    |
| (價量, 新聞, 財報, 替代數據)     |
+---------------------------------+
                 |
                 V
+---------------------------------+
|   ML/DL 感官系統 (特徵提取)     |
| - LSTM/Transformer (趨勢感知)    |
| - FinBERT (情緒感知)            |
| - GNN (關聯感知)                |
| - CNN (形態感知)                |
+---------------------------------+
                 |
                 V
+---------------------------------+
|   強化學習大腦 (決策核心)       |
|  - 整合所有感官資訊形成「狀態」   |
|  - 權衡風險與回報                |
|  - 輸出最佳「行動」 (買/賣/持有)  |
+---------------------------------+
                 |
                 V
+---------------------------------+
|   交易執行層 (Capital.com API)  |
+---------------------------------+
                 |
                 V
+---------------------------------+
|   市場反饋 (盈虧 -> 獎勵/懲罰)   |
+---------------------------------+
```

## 5. 視覺化儀表板需求 (Dashboard Requirements)

儀表板是洞察AI「思考過程」的窗口，應包含以下三個主要分頁：

### 📈 **分頁一：Alpha生成 & 市場感知**

* **目標**: 呈現AI Agent在做決策前，「看到」和「感覺到」了什麼。
* **圖表設計**:
    * **主圖**: K線圖 + **RL Agent的實際交易點**（用箭頭標示買賣點及盈虧）。
    * **副圖一**: `LSTM/Transformer` 輸出的**未來趨勢預測分數曲線**。
    * **副圖二**: `FinBERT` 輸出的**市場情緒分數時序圖**。
    * **對比分析**: 傳統技術指標信號 (如RSI) vs. AI交易信號的準確率與回報比較。

### 📊 **分頁二：投資組合 & 策略績效**

* **目標**: 評估AI Agent決策所產生的最終績效與風險。
* **圖表設計**:
    * **累積報酬曲線**: 將AI策略的淨值曲線與Benchmark（如SPY或BTC現貨）進行對比。
    * **風險指標儀表板**: 顯示**最大回撤 (Max Drawdown)**、**夏普比率 (Sharpe Ratio)**、**年化波動率**等關鍵指標。
    * **資產關聯網絡圖**: 由 `GNN` 輸出，視覺化呈現投資組合中各資產的關聯性與潛在風險集中度。
    * **動態倉位變化圖**: 面積圖或堆疊條形圖，展示 MPT 策略中各資產權重的動態調整過程。

### ⚙️ **分頁三：交易執行 & Agent行為分析**

* **目標**: 深入AI大腦，理解其決策偏好與執行效率。
* **圖表設計**:
    * **RL Agent決策分佈熱力圖 (Heatmap)**: X軸可以是市場波動率，Y軸可以是趨勢強度，顏色深淺表示Agent在該狀態下選擇`買`/`賣`/`持有`的概率。
    * **滑價分析 (Slippage Analysis)**: 散點圖，展示預期成交價 vs. 實際成交價的差異。
    * **成交量分佈**: 分析Agent的交易主要分佈在一天中的哪些時段，以及當時的市場深度。
    * **獎勵函數曲線 (Reward Curve)**: 顯示Agent在訓練過程中，獎勵值的變化趨勢，以判斷模型是否收斂。

## 6. 開發路線圖建議 (Suggested Roadmap)

1.  **階段一：基礎建設**:
    * 完善 `Capital.com` 的數據接口，確保穩定獲取價量數據。
    * 建立數據清洗、特徵工程（如計算各種技術指標）的標準化流程。
    * 搭建基礎的回測引擎框架。
2.  **階段二：感官模型開發**:
    * 獨立開發並訓練第一個「感官」模型，例如用於預測趨勢的 `LSTM`。
    * 在儀表板的「Alpha生成」分頁中，視覺化其預測結果。
3.  **階段三：強化學習大腦搭建**:
    * 為「個股當沖策略」設計並建立第一個RL環境 (Environment)。
    * 訓練一個初步的RL Agent，並在「執行效率」分頁中視覺化其決策行為。
4.  **階段四：整合與優化**:
    * 將多個感官模型（LSTM, FinBERT等）的輸出整合到RL Agent的狀態(State)中。
    * 反覆進行訓練、回測、視覺化分析，迭代優化Agent的獎勵函數與模型架構。
5.  **階段五：MPT策略擴展**:
    * 將RL環境擴展至多股票場景。
    * 修改Agent的行動空間(Action Space)為輸出投資組合權重。
    * 開發GNN模型並整合進系統。